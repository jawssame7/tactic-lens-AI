# サッカー戦術分析チャットボット 要件定義書

## 1. 概要

Gemini API を活用したサッカー戦術分析 Web アプリケーション。画像・動画をアップロードして戦術的なアドバイスを受けられるチャットボット。

## 2. 機能要件

### 2.1 基本機能

#### 2.1.1 画像アップロード

- 対応形式: JPG, PNG, WebP
- 最大ファイルサイズ: 4MB
- 機能:
  - プレビュー表示
  - ドラッグ&ドロップ対応
  - ファイル選択ボタン

#### 2.1.2 動画アップロード（フェーズ 2）

- 対応形式: MP4, MOV, WebM
- 最大長: 15 秒
- 最大ファイルサイズ: 15MB
- 推奨用途: 特定プレーシーンの切り出し分析

#### 2.1.3 テキスト入力

- チャット形式の入力フィールド
- 画像・動画の有無に関わらず質問可能
- マルチライン対応
- Enter キーで送信（Shift+Enter で改行）

#### 2.1.4 AI 分析機能

**画像分析:**

- フォーメーション認識
- 選手配置の分析
- スペース活用の評価
- 戦術的な改善点の提案
- 具体的なプレー例の提示

**動画分析（フェーズ 2）:**

- 時系列での選手の動き分析
- スペースの変化
- プレスのタイミング評価
- 攻守の切り替え速度
- ボール保持者への寄せの分析

#### 2.1.5 会話履歴

- セッション内での会話履歴保持
- 過去の文脈を考慮した回答生成
- 履歴のクリア機能
- 画像・動画のサムネイル表示

## 3. UI/UX 要件

### 3.1 レイアウト

- チャットインターフェース（メッセンジャー風）
- レスポンシブデザイン（PC・タブレット・スマホ対応）
- 画像・動画・テキストの混在表示
- 左右バブル形式（ユーザー/AI）

### 3.2 ユーザビリティ

- ローディング状態の明示的な表示
- エラーハンドリングとわかりやすいエラーメッセージ
- 送信ボタンの有効/無効切り替え
- 動画処理中のプログレスバー表示
- アップロードファイルの削除機能

## 4. 技術要件

### 4.1 フロントエンド

- フレームワーク: React 18+ with TypeScript
- 状態管理: useState / useContext
- スタイリング: Tailwind CSS
- 画像処理: Base64 エンコード
- ビルドツール: Vite または Create React App

### 4.2 バックエンド

- 実行環境: AWS Lambda (Node.js 20.x)
- API: API Gateway (REST API)
- AI: Gemini API (1.5 Flash / 1.5 Pro)
- ストレージ: S3（静的ファイルホスティング）
- CDN: CloudFront

### 4.3 API 仕様

#### エンドポイント

```
POST /api/analyze
```

#### リクエスト

```typescript
{
  message: string; // ユーザーのメッセージ
  image?: string; // Base64 エンコードされた画像
  video?: string; // Base64 エンコードされた動画（フェーズ 2）
  conversationHistory?: Array<{ // 会話履歴
    role: 'user' | 'assistant';
    content: string;
  }>;
}
```

#### レスポンス

```typescript
{
  reply: string; // AI の返答
  timestamp: string; // ISO 8601 形式
  processingTime?: number; // 処理時間（ミリ秒）
}
```

#### エラーレスポンス

```typescript
{
  error: string; // エラーメッセージ
  code: string; // エラーコード
}
```

## 5. Gemini API 仕様

### 5.1 モデル選択

- **開発・テスト**: Gemini 1.5 Flash（無料枠活用）
- **本番**: Gemini 1.5 Pro（高精度が必要な場合）

### 5.2 プロンプト設計

#### システムプロンプト

```text
あなたはプロサッカーの戦術アナリストです。
画像や動画から試合状況を分析し、具体的で実践的な戦術アドバイスを提供してください。

分析の観点:

- フォーメーションと選手配置
- スペースの活用状況
- プレスとプレス回避
- 攻守の切り替え
- ボール保持とポジショニング

回答形式:

- 見出しと箇条書きを使った構造化
- 具体的な改善案の提示
- 実例やプレーパターンの説明
```

### 5.3 出力形式

- Markdown 形式での構造化された回答
- 見出し、箇条書き、太字の活用
- 簡潔で読みやすい表現

## 6. セキュリティ要件

### 6.1 認証・認可

- フェーズ 1: 認証なし（パブリックアクセス）
- フェーズ 2 以降: 検討事項

### 6.2 データ保護

- Gemini API Key とタイムアウト設定（`GEMINI_API_KEY`, `GEMINI_API_TIMEOUT_MS`）を Lambda 環境変数で管理
- API Gateway での CORS 設定
- ファイルサイズ制限の実装
- 不正なファイル形式の検証

### 6.3 レート制限

- フェーズ 1: なし
- フェーズ 2: API Gateway レベルでの制限検討

## 7. 非機能要件

### 7.1 パフォーマンス

- 画像分析レスポンス: 5 秒以内（通常時）
- 動画分析レスポンス: 15 秒以内（通常時）
- フロントエンド初期表示: 2 秒以内

### 7.2 可用性

- CloudFront + S3 による高可用性
- Lambda 自動スケーリング

### 7.3 拡張性

後続機能との統合を考慮した設計:

- 戦術ボード＋ AI アシスタント
- 試合状況シミュレーター
- 練習メニュージェネレーター

## 8. 開発フェーズ

### フェーズ 1: 画像ベースチャットボット（MVP）

- 画像アップロード機能
- テキストチャット機能
- Gemini API 連携
- 基本的な UI/UX

### フェーズ 2: 動画分析対応

- 15 秒動画アップロード
- 動画分析機能
- プログレスバー実装

### フェーズ 3: 機能拡張

- 会話履歴の永続化
- ユーザー認証
- 分析結果のエクスポート

## 9. スコープ外（将来検討）

### 9.1 現時点で実装しない機能

- ユーザー認証・アカウント管理
- 会話履歴のデータベース保存
- 複数セッション管理
- 有料プラン・課金機能
- ソーシャルシェア機能
- チーム共有機能

## 10. 制約事項

### 10.1 技術的制約

- Gemini API 無料枠の制限（1 日 1500 リクエスト）
- Lambda 実行時間制限（最大 15 分、実用は 30 秒以内を推奨）
- API Gateway ペイロードサイズ制限（10MB）

### 10.2 コスト制約

- 開発段階は月数ドル以内に抑える
- 無料枠を最大限活用

## 11. 成功基準

### 11.1 機能面

- 画像をアップロードして 3 秒以内に分析結果が表示される
- 戦術的に意味のある具体的なアドバイスが得られる
- エラーなく連続して会話が継続できる

### 11.2 ユーザー体験

- 直感的で迷わず使える
- モバイルでも快適に操作できる
- レスポンスが速く、ストレスがない

---
